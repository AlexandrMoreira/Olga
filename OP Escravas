--> DEFINE OPERAÇÕES ESCRAVAS QUANDO HOUVER ROTA DE EMBALAGAEM (MTO E INDUSTRIALIZACAO) EM OPERAÇÕES ABERTAS <--



DO BEGIN

Embalagem = 
SELECT
	ROTA."AG_ID" AS "OPERAÇÃO",
	OP."TYP" AS "TIPO",
	ROTA."BELNR_ID",
	ROTA."BELPOS_ID",
	ROTA."POS_ID"

FROM BEAS_FTAPL ROTA
INNER JOIN BEAS_FTHAUPT OP ON ROTA."BELNR_ID" = OP."BELNR_ID"	
WHERE ROTA."AG_ID" = 'EMBALAGEM'
	AND OP."TYP" IN ('MTO', 'INDUSTRIALIZACAO') 
	AND OP."ABGKZ" = 'N'
ORDER BY OP."TYP" DESC

;
UPDATE ROTA SET ROTA."MASTER_POS_ID" = EMB."POS_ID"

/*SELECT

	ROTA."BELNR_ID",
	ROTA."BELPOS_ID",
	ROTA."POS_ID",
	ROTA."MASTER_POS_ID", 
	EMB."POS_ID"*/
	
FROM BEAS_FTAPL ROTA
INNER JOIN :Embalagem EMB ON ROTA."BELNR_ID" = EMB."BELNR_ID" AND ROTA."BELPOS_ID" = EMB."BELPOS_ID" AND ROTA."POS_ID" <> EMB."POS_ID"
WHERE IFNULL (ROTA."MASTER_POS_ID", '0') <>
	  EMB."POS_ID"

;
END
;


